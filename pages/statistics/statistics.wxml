<!--statistics.wxml-->
<wxs module="styleHelper">
  function buildStyleString(style) {
    if (!style) return '';
    var result = '';
    var keys = Object.keys(style);
    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      result += key + ':' + style[key] + ';';
    }
    return result;
  }
  module.exports = {
    buildStyle: buildStyleString
  };
</wxs>

<view class="container safe-area-bottom safe-area-top" data-theme="{{theme}}" style="{{app.globalData.themeStyle ? styleHelper.buildStyle(app.globalData.themeStyle) : ''}}">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading"></view>
    <view class="loading-text">加载中...</view>
  </view>
  
  <block wx:if="{{!loading}}">
    <!-- 资产概览 -->
    <view class="card">
      <view class="card-header">资产概览</view>
      <view class="overview-content">
        <view class="stats-item">
          <view class="stats-value">¥{{overview.totalValue}}</view>
          <view class="stats-label">总资产</view>
        </view>
        <view class="stats-divider"></view>
        <view class="stats-item">
          <view class="stats-value">{{overview.assetCount}}</view>
          <view class="stats-label">资产数量</view>
        </view>
        <view class="stats-divider"></view>
        <view class="stats-item">
          <view class="stats-value">¥{{overview.dailyAverage}}</view>
          <view class="stats-label">日均成本</view>
        </view>
      </view>
    </view>
    
    <!-- 分类统计 -->
    <view class="card" wx:if="{{categories.length > 0}}">
      <view class="card-header">分类统计</view>
      
      <!-- 简易饼图 -->
      <view class="chart-container" wx:if="{{categories.length > 0}}">
        <view class="donut-chart">
          <view class="donut-segments">
            <block wx:for="{{categories}}" wx:key="name">
              <view class="donut-segment" style="transform: rotate({{item.startAngle}}deg);">
                <view class="donut-segment-inner" style="background-color: {{item.color}}; transform: rotate({{item.sweepAngle}}deg);"></view>
              </view>
            </block>
          </view>
          <view class="donut-hole">
            <view class="donut-total-label">总资产</view>
            <view class="donut-total-value">¥{{overview.totalValue}}</view>
          </view>
        </view>
        
        <!-- 分类图例 -->
        <view class="category-list">
          <view class="category-item" wx:for="{{categories}}" wx:key="name">
            <view class="category-color" style="background-color: {{item.color}}"></view>
            <view class="category-info">
              <view class="category-name">{{item.name}}</view>
              <view class="category-detail">
                <view class="category-value">¥{{item.value}}</view>
                <view class="category-percent">{{item.percentage}}% ({{item.count}})</view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 无分类提示 -->
      <view class="empty-state" wx:else>
        <text class="fa fa-folder-open" style="font-size: 80rpx; color: #ddd; margin-bottom: 20rpx;"></text>
        <text class="empty-state-text">暂无分类数据</text>
      </view>
    </view>
    
    <!-- 资产排行 -->
    <view class="card">
      <view class="card-header">资产排行</view>
      
      <!-- 最常使用 -->
      <view class="ranking-section" wx:if="{{mostUsedAssets.length > 0}}">
        <view class="ranking-title">
          <text class="fa fa-star ranking-icon" style="color: #FFD166;"></text>最常使用
        </view>
        <view class="stats-row" wx:for="{{mostUsedAssets}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
          <view>{{index + 1}}. {{item.name}}</view>
          <view>{{item.usageCount}}次</view>
        </view>
      </view>
      
      <!-- 无数据提示 -->
      <view class="empty-state-mini" wx:if="{{mostUsedAssets.length === 0}}">
        <text class="empty-state-text">暂无使用数据</text>
      </view>
    </view>
    
    <!-- 最近添加 -->
    <view class="card">
      <view class="card-header">最近添加</view>
      
      <view wx:if="{{recentlyAddedAssets.length > 0}}">
        <view class="stats-row" wx:for="{{recentlyAddedAssets}}" wx:key="id" bindtap="goToDetail" data-id="{{item.id}}">
          <view class="recent-asset-info">
            <text class="fa fa-cube recent-asset-icon"></text>
            <text>{{item.name}}</text>
            <text class="recent-asset-price">¥{{item.price}}</text>
          </view>
          <view class="recent-asset-meta">
            <text class="recent-asset-time">{{item.relativeTime}}</text>
          </view>
        </view>
      </view>
      
      <!-- 无数据提示 -->
      <view class="empty-state-mini" wx:else>
        <text class="empty-state-text">暂无资产数据</text>
      </view>
    </view>
  </block>
  
  <!-- 使用自定义tabBar组件 -->
  <tab-bar selected="1"></tab-bar>
</view> 